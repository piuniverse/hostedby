principalSet://iam.googleapis.com/projects/175489563131/locations/global/workloadIdentityPools/github-auth/attribute.repository/stclaird/hostedby
export WIF_SERVICE_ACCOUNT = github-actions-authentication@hosted-ip.iam.gserviceaccount.com
export WIF_PROVIDER = projects/175489563131/locations/global/workloadIdentityPools/github-actions-wif-pool/providers/github-actions-wif-provider

gcloud iam service-accounts create githubactions --display-name="GitHub Actions" --project "corporate-363313"

gcloud services enable iamcredentials.googleapis.com \
  --project "corporate-363313"

gcloud iam workload-identity-pools create "github-actions-wif-pool" \
  --project="corporate-363313" \
  --location="global" \
  --display-name="GitHub Actions WIF Pool"

gcloud iam workload-identity-pools providers create-oidc "github-actions-wif-provider" \
  --project="corporate-363313" \
  --location="global" \
  --workload-identity-pool="github-actions-wif-pool" \
  --display-name="GitHub Actions Auth Provider" \
  --attribute-mapping="google.subject=assertion.sub,attribute.actor=assertion.actor,attribute.aud=assertion.aud" \
  --issuer-uri="https://token.actions.githubusercontent.com"

gcloud iam service-accounts add-iam-policy-binding "githubactions@corporate-363313.iam.gserviceaccount.com" \
  --project="corporate-363313" \
  --role="roles/iam.workloadIdentityUser" \
  --member="principalSet://iam.googleapis.com/projects/352834995063/locations/global/workloadIdentityPools/github-actions-wif-pool/attribute.repository/piuniverse/hostedby"


gcloud iam workload-identity-pools providers describe "github-actions-wif-provider" \
  --project="corporate-363313" \
  --location="global" \
  --workload-identity-pool="github-actions-wif-pool" \
  --format="value(name)"
